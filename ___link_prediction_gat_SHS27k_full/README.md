# A Biological Knowledge Graph for Representational Learning 
This repository provides the code for our research project "A Biological Knowledge Graph for Representational Learning".

 
edge_prediction_project/
│
├── data/
│   └── neo4j_graph.json
│
├── results/
│
├── src/
│   ├── __init__.py
│   ├── data_loader.py
│   ├── models.py
│   ├── utils.py
│   └── train.py
│
└── main.py

## python link_prediction_gat/main.py --out-feats 128 --num-heads 4 --num-layers 2 --lr 0.01 --input-size 2 --hidden-size 16 --feat-drop 0.1 --attn-drop 0.1 --epochs 213

python auc_sagegraph_bkg/main.py --learning-rate 0.0005 --input-size 2 --hidden-size 128 --epochs 20000

## Data resources
The different dataset and KG used in this project are located in data directory. These files include:

-) The data about pathways from https://reactome.org/download/current/ReactomePathways.txt, relationships between pathways from https://reactome.org/download/current/ReactomePathwaysRelation.txt and pathway-protein relations from https://reactome.org/download/current/NCBI2Reactome.txt on 24 March 2024.

-) The built knowledge graph including pathway-pathway and pathway-protein relationships.


## Scripts
The code directory contains the following scripts:

-)The script for processing data download from Reactome

-)The script for building KG and save to Neo4j Aura.


## Setup
-)conda create -n kg python=3.10 -y

-)conda activate kg

-)pip install -r requirements.txt


## Get start
python scripts/reactome/kg_reactome.py

python link_prediction_gat/main.py --in-feats 128 --out-feats 128 --num-heads 4 --num-layers 2 --lr 0.01 --input-size 2 --hidden-size 16 --feat-drop 0.1 --attn-drop 0.1 --epochs 2001

## AssertionError: out_feats must be divisible by num_heads  (33096x2 and 8x16)
python gat/edges_prediction.py --out-feats 2 --num-layers 2 --num-heads 4 --input-size 2 --epochs 1000

python link_prediction_gat/main.py --lr 0.01 --out-feats 4 --num-layers 2 --num-heads 2 --hidden-size 16 --input-size 1 --epochs 1000

## Recall 0
lr = 0.01 faster convergence than lr = 0.0001


#### residual=true
python link_prediction_gat/main.py --out-feats 128 --num-heads 2 --num-layers 2 --lr 0.01 --input-size 2 --hidden-size 16 --feat-drop 0.1 --attn-drop 0.1 --epochs 503

Input Features  ----> Linear Transformation ----> Attention Mechanism ----> Message Passing ----> Output Features
      \                                                                                                 /
       \                                                                                               /
        ------------------------------------ Residual Connection --------------------------------------


####
    +-----------------+         +-----------------+         +-----------------+
   |                 |         |                 |         |                 |
   | Input Features  | ------> | Linear          | ------> | Attention       |
   |                 |         | Transformation  |         | Mechanism       |
   |                 |         |                 |         |                 |
   +-----------------+         +-----------------+         +-----------------+
                                                                 |
                                                                 V
   +-----------------+         +-----------------+         +-----------------+
   |                 |         |                 |         |                 |
   | Dropout &       | ------> | Message Passing | ------> | Residual        |
   | Leaky ReLU      |         |                 |         | Connection      |
   |                 |         |                 |         |                 |
   +-----------------+         +-----------------+         +-----------------+
                                                                 |
                                                                 V
                                                           +-----------------+
                                                           |                 |
                                                           | Activation &    |
                                                           | Bias Addition   |
                                                           |                 |
                                                           +-----------------+
                                                                 |
                                                                 V
                                                           +-----------------+
                                                           |                 |
                                                           | Link Prediction |
                                                           | (e.g., Dot      |
                                                           | Product, etc.)  |
                                                           |                 |
                                                           +-----------------+



## PASS !!
Test AUC: 0.7640 ± 0.0105 | Test F1: 0.7371 ± 0.0080 | Test Precision: 0.6462 ± 0.0086 | Test Recall: 0.8578 ± 0.0114 | Test mAP: 0.7352 ± 0.0127
(kg39) ericsali@erics-MacBook-Pro-4 gnn_pathways % python link_prediction_gat/main.py --out-feats 32 --num-layers 4 --num-heads 4 --hidden-size 16 --input-size 2 --lr 0.01 --epochs 100


                       +-------------------+
                       | Initialize Module |
                       |                   |
                       |   - in_feats      |
                       |   - out_feats     |
                       |   - num_heads     |
                       |   - feat_drop     |
                       |   - attn_drop     |
                       |   - negative_slope|
                       |   - residual      |
                       |   - activation    |
                       |   - allow_zero_in_degree|
                       |   - bias          |
                       +---------+---------+
                                 |
                                 v
+------------------+        +----+----+        +-----------------------+
| Dropout (feat)   | -----> | Linear  | -----> | Attention Mechanism   |
|                  |        |  (fc)   |        | - attn_l, attn_r      |
|                  |        +---------+        +-----------------------+
|                  |                          /          \
+------------------+                         /            \
                                            /              \
                    +----------------+     /                \     +-------------------+
                    | Input Features | -->/    +------------+--> | Update Graph Data  |
                    +----------------+   /     | LeakyReLU  |    +-------------------+
                                          \    +------------+      - attn_drop
                                           \                        - edge_softmax
                                            \                     +-------------------+
                                             \                    | Message Passing   |
                                              \                   | - fn.u_mul_e      |
                                               \                  | - fn.sum          |
                                                \                 +-------------------+
                                                 \
                       +-------------------+      \
                       | Residual Connection|      \
                       +-------------------+       \
                       | - res_fc          |        \
                       +-------------------+         \
                                                      \
                       +-------------------+           \
                       | Bias Addition     |            \
                       +-------------------+             \
                       | - bias            |              \
                       +-------------------+               \
                                                          +-------------------+
                                                          | Activation        |
                                                          +-------------------+
                                                          | - activation      |
                                                          +-------------------+
                                                                  |
                                                                  v
                                                         +-------------------+
                                                         | Output Features   |
                                                         +-------------------+




+---------------------------------------------------------------------------------------+
|                                Link Prediction Process                                |
+---------------------------------------------------------------------------------------+
|                                                                                       |
|              +-------------------+       +-------------------+       +--------------+  |
|              |    Graph Data     |       |  Node Embeddings  |       | Link Scores  |  |
|              |                   |       |      (Vectors)    |       |    (Scores)  |  |
|              +-------------------+       +-------------------+       +--------------+  |
|                       |                           |                          |         |
|                       |        +------------------+---------------------------+         |
|                       |        |                          |                          |         |
|      +----------------+--------v------------------+ +-----v-------------+   +-------v----------+|
|      |           Graph Construction     |        | |   Embedding Model   |   |  Link Prediction  ||
|      |   (Builds pathway graphs)        +--------> (e.g., GAT, GCN, etc)|   |  (e.g., MLP)      ||
|      +--------------------------------+        | +---------------------+   +-------------------+
|                       |        ^                          |                          |         |
|                       |        |                          |                          |         |
|         +-------------+--------+--------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +---------------------------------------------+|
|  |   Node Features   |                |                    Graph Features            ||
|  |                   |                |                    (Pathway-Level)           ||
|  +-------------------+                +---------------------------------------------+
|                       |                           |                          |         |
|         +-------------+---------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +-----------------+                +--------------+
|  |  Node Embeddings  |                |  Clustering Alg  |                |  Clustered   |
|  |                   |                |   (e.g., K-means) |                |   Nodes      |
|  +-------------------+                +-----------------+                +--------------+
|                       |                           |                          |         |
+-----------------------+---------------------------+--------------------------+---------+


#####
#####
+----------------------------------------------------------------------------------------+
|                   Combined Framework for Pathway and Link Prediction                   |
+----------------------------------------------------------------------------------------+
|                                                                                        |
|             +----------------------+      +----------------------+      +----------+   |
|             |   Hyperparameters    |      |     Data Files       |      |  Models  |   |
|             +----------------------+      +----------------------+      +----------+   |
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +--------------------------------+  +-----------------------------+  +------------------+|
|   | Initialize Parameters          |  | Load Data and Preprocessing |  |  Build Models    ||
|   +--------------------------------+  +-----------------------------+  +------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   |  Graph Construction         |  | Pathway Mapping             |  |  GAT Model         ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Create DataLoaders          |  | Initialize Training Metrics |  |  Train Model       ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Train Loop                  |  | Validate Loop               |  |  Save Best Model   ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Calculate Node Embeddings   |  | Cluster Node Embeddings     |  |  Save Results      ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Visualize Embeddings        |  | Evaluate Clustering         |  |  Save Visuals      ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Split Data for Link Pred.   |  | Create Pos/Neg Samples      |  |  Initialize Model  ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Train Link Pred. Model      |  | Evaluate Link Pred.         |  |  Save Link Pred.   ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Test Link Pred. Model       |  | Plot Results                |  |  Save Test Results ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                                                                                        |
+----------------------------------------------------------------------------------------+
###
###
###



+----------------------------------------------------------------------------------------+
|                   Combined Framework for Link Prediction and Embeddings                |
+----------------------------------------------------------------------------------------+
|                                                                                        |
|             +----------------------+      +----------------------+      +----------+   |
|             |   Hyperparameters    |      |     Data Files       |      |  Models  |   |
|             +----------------------+      +----------------------+      +----------+   |
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +--------------------------------+  +-----------------------------+  +------------------+|
|   | Initialize Parameters          |  | Load Data and Preprocessing |  |  Build Models    ||
|   +--------------------------------+  +-----------------------------+  +------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   |  Graph Construction         |  | Pathway Mapping             |  |  GAT Model         ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Create DataLoaders          |  | Initialize Training Metrics |  |  Train Model       ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Train Loop                  |  | Validate Loop               |  |  Save Best Model   ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Calculate Node Embeddings   |  | Cluster Node Embeddings     |  |  Save Results      ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Visualize Embeddings        |  | Evaluate Clustering         |  |  Save Visuals      ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Split Data for Link Pred.   |  | Create Pos/Neg Samples      |  |  Initialize Model  ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Train Link Pred. Model      |  | Evaluate Link Pred.         |  |  Save Link Pred.   ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                      |                          |                          |           |
|                      v                          v                          v           |
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|   | Test Link Pred. Model       |  | Plot Results                |  |  Save Test Results ||
|   +-----------------------------+  +-----------------------------+  +--------------------+|
|                                                                                        |
+----------------------------------------------------------------------------------------+


+---------------------------------------------------------------------------------------+
|                                Human Pathway Embeddings Training Framework            |
+---------------------------------------------------------------------------------------+
|                                                                                       |
|              +----------------------+      +----------------------+      +----------+  |
|              |   Hyperparameters    |      |     Data Files       |      |  Models  |  |
|              +----------------------+      +----------------------+      +----------+  |
|                       |                          |                          |         |
|                       |                          |                          |         |
|                       v                          v                          v         |
|     +-----------------------------+  +-----------------------------+   +------------------+|
|     | Initialize Parameters       |  | Load Data and Preprocessing |   |  Build Models    ||
|     +-----------------------------+  +-----------------------------+   +------------------+|
|                       |                          |                          |         |
|                       |                          |                          |         |
|                       v                          v                          v         |
|   +--------------------------------+  +----------------------------+   +------------------+|
|   |  Graph Construction            |  |  Pathway Mapping           |   |  GAT Model       ||
|   +--------------------------------+  +----------------------------+   +------------------+|
|                       |                          |                          |         |
|                       |                          |                          |         |
|                       v                          v                          v         |
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|   | Create DataLoaders          |  | Initialize Training Metrics |   |  Train Model      ||
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|                       |                          |                          |         |
|                       v                          v                          v         |
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|   | Train Loop                  |  | Validate Loop               |   |  Save Best Model  ||
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|                       |                          |                          |         |
|                       v                          v                          v         |
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|   | Calculate Node Embeddings   |  | Cluster Node Embeddings     |   |  Save Results     ||
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|                       |                          |                          |         |
|                       v                          v                          v         |
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|   | Visualize Embeddings        |  | Evaluate Clustering         |   |  Save Visuals     ||
|   +-----------------------------+  +-----------------------------+   +-------------------+|
|                                                                                       |
+---------------------------------------------------------------------------------------+
####

####
+---------------------------------------------------------------------------------------+
|                                Human Pathway Embeddings                               |
+---------------------------------------------------------------------------------------+
|                                                                                       |
|              +-------------------+       +-------------------+       +--------------+  |
|              |    Pathway Data   |       |     Node Embeds    |       |   Link Pred  |  |
|              |    (Graph Data)   |       |      (Vectors)     |       |    (Edges)   |  |
|              +-------------------+       +-------------------+       +--------------+  |
|                       |                           |                          |         |
|                       |                           |                          |         |
|                       |                           |                          |         |
|      +----------------+-----------------+  +------+-------------+   +-------v----------+|
|      |           Graph Construction     |  |   Embedding Model   |   |  Link Prediction  ||
|      |                                |  | (e.g., GAT, GCN, etc)|   |  (e.g., MLP)      ||
|      +--------------------------------+  +---------------------+   +-------------------+
|                       |                           |                          |         |
|                       |                           |                          |         |
|         +-------------+---------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +---------------------------------------------+|
|  |   Node Features   |                |                    Graph Features            ||
|  |                   |                |                    (Pathway-Level)           ||
|  +-------------------+                +---------------------------------------------+
|                                                                                       |
+---------------------------------------------------------------------------------------+


+---------------------------------------------------------------------------------------+
|                                Human Pathway Embeddings                               |
+---------------------------------------------------------------------------------------+
|                                                                                       |
|              +-------------------+       +-------------------+       +--------------+  |
|              |    Pathway Data   |       |     Node Embeds    |       |   Link Pred  |  |
|              |    (Graph Data)   |       |      (Vectors)     |       |    (Edges)   |  |
|              +-------------------+       +-------------------+       +--------------+  |
|                       |                           |                          |         |
|                       |                           |                          |         |
|                       |                           |                          |         |
|      +----------------+-----------------+  +------+-------------+   +-------v----------+|
|      |           Graph Construction     |  |   Embedding Model   |   |  Link Prediction  ||
|      |                                |  | (e.g., GAT, GCN, etc)|   |  (e.g., MLP)      ||
|      +--------------------------------+  +---------------------+   +-------------------+
|                       |                           |                          |         |
|                       |                           |                          |         |
|         +-------------+---------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +---------------------------------------------+|
|  |   Node Features   |                |                    Graph Features            ||
|  |                   |                |                    (Pathway-Level)           ||
|  +-------------------+                +---------------------------------------------+
|                       |                           |                          |         |
|         +-------------+---------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +-----------------+                +--------------+
|  |  Node Embeddings  |                |  Clustering Alg  |                |  Clustered   |
|  |                   |                |   (e.g., K-means) |                |   Nodes      |
|  +-------------------+                +-----------------+                +--------------+
|                       |                           |                          |         |
+-----------------------+---------------------------+--------------------------+---------+


+---------------------------------------------------------------------------------------+
|                                Human Pathway Embeddings                               |
+---------------------------------------------------------------------------------------+
|                                                                                       |
|              +-------------------+       +-------------------+       +--------------+  |
|              |    Pathway Data   |       |     Node Embeds    |      |   Link Pred  |  |
|              |    (Graph Data)   |       |      (Vectors)     |      |    (Edges)   |  |
|              +-------------------+       +-------------------+       +--------------+  |
|                       |                           |                          |         |
|                       |        +------------------+---------------------------+         |
|                       |        |                          |                          |         |
|      +----------------+--------v------------------+ +-----v-------------+   +-------v----------+|
|      |           Graph Construction     |        | |   Embedding Model  |   |  Link Prediction  ||
|      |   (Builds pathway graphs)        +--------> (e.g., GAT, GCN, etc)|   |  (e.g., MLP)      ||
|      +--------------------------------+        | +---------------------+   +-------------------+
|                       |        ^                          |                          |         |
|                       |        |                          |                          |         |
|         +-------------+--------+--------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +---------------------------------------------+|
|  |   Node Features   |                |                    Graph Features            ||
|  |                   |                |                    (Pathway-Level)           ||
|  +-------------------+                +---------------------------------------------+
|                       |                           |                          |         |
|         +-------------+---------------------------+--------------------------+---------+
|         |                                                                             |
|  +------+-------------+                +-----------------+                +--------------+
|  |  Node Embeddings  |                |  Clustering Alg  |                |  Clustered   |
|  |                   |                |   (e.g., K-means) |                |   Nodes      |
|  +-------------------+                +-----------------+                +--------------+
|                       |                           |                          |         |
+-----------------------+---------------------------+--------------------------+---------+



+---------------------------------------------------------------------------------------+
|                                Human Pathway Embeddings                               |
+---------------------------------------------------------------------------------------+
|                                                                                       |
|              +-------------------+       +-------------------+       +--------------+ |
|              |    Pathway Data   |       |     Node Embeds   |       |   Link Pred  | |
|              |    (Graph Data)   |       |      (Vectors)    |       |    (Edges)   | |
|              +-------------------+       +-------------------+       +--------------+ |
|                       |                           |                          |        |
|                       |                           |                          |        |
|                       |                           |                          |        |
|      +----------------v--------+------------------v------------------+------v-------+ |
|      |         Graph Construction       |      Embedding Model       |   Link Pred  | |
|      |      (Builds pathway graphs)     |    (e.g., GAT, GCN, etc.)  | (e.g., MLP)  | |
|      +----------------+--------+--------+------------------^---------+--------------+ |
|                       |        ^                          |                          |        |
|                       |        |                          |                          |        |
|         +-------------v--------+--------------------------+--------------------------+--------+
|         |                                                                             |
|  +------+-------------+                +---------------------------------------------+ |
|  |   Node Features   |                |                    Graph Features            | |
|  |                   |                |                    (Pathway-Level)           | |
|  +-------------------+                +---------------------------------------------+ |
|                       |                           |                          |        |
|                       |                           |                          |        |
|         +-------------v---------------------------+--------------------------+--------+
|         |                                                                             |
|  +------+-------------+                +-----------------+                +--------------+
|  |  Node Embeddings  |                |  Clustering Alg  |                |  Clustered   |
|  |                   |                |   (e.g., K-means)|                |   Nodes      |
|  +-------------------+                +-----------------+                +--------------+
|                       |                           |                          |        |
+-----------------------+---------------------------+--------------------------+--------+






